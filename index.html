<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Open Gamisodes App</title>
  <script>
    window.onload = function () {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const iosAppUri = "gamisodes://babyeinstein";
      const androidAppUri = "gamisodes://babyeinstein";

      // Determine page for referrer
      const path = window.location.pathname.toLowerCase();
      let page = "organic";
      if (path.includes("babyeinstein")) page = "babyeinstein";
      else if (path.includes("digdug")) page = "digdug";
      else if (path.includes("inspectorgadget")) page = "inspectorgadget";
      console.log("Detected page:", page);

      // URLs with dynamic referrer
      const iosAppStoreUrl = "https://apps.apple.com/us/app/gamisodes/id6691440023";
      const androidPlayStoreUrl = `https://play.google.com/store/apps/details?id=com.Gamisodes&referrer=${encodeURIComponent(page)}`;
      const androidMarketUri = `market://details?id=com.Gamisodes&referrer=${encodeURIComponent(page)}`;

      // Android
      if (/android/i.test(userAgent)) {
        console.log("Attempting to open app: ", androidAppUri);
        window.location.href = androidAppUri;

        // Fallback to Play Store
        setTimeout(function() {
          console.log("Trying market:// URI: ", androidMarketUri);
          // Use window.location.href to force Play Store app
          window.location.href = androidMarketUri;
          // Fallback to web URL only if market:// fails
          setTimeout(function() {
            console.log("Falling back to web URL: ", androidPlayStoreUrl);
            window.location.href = androidPlayStoreUrl;
          }, 1000); // Increased to 1s for reliability
        }, 2000); // Increased to 2s to give app time to open
      }
      // iOS
      else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        console.log("Attempting to open iOS app: ", iosAppUri);
        const start = Date.now();
        window.location.href = iosAppUri;
        setTimeout(function() {
          if (Date.now() - start < 1500) {
            console.log("Falling back to App Store: ", iosAppStoreUrl);
            window.location.href = iosAppStoreUrl;
          }
        }, 1000);
      }
      // Other devices
      else {
        console.log("Non-mobile device, showing manual links");
        document.getElementById("message").innerHTML =
          "<p>Please download the app:</p>" +
          "<a href='" + iosAppStoreUrl + "'>iOS</a> | " +
          "<a href='" + androidPlayStoreUrl + "'>Android</a>";
      }
    };
  </script>
</head>
<body>
  <div id="message" style="text-align: center; padding-top: 100px;">
    <p>Redirecting you to the right app store...</p>
  </div>
</body>
</html>